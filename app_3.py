import streamlit as st
import requests
from PIL import Image
from io import BytesIO
from ultralytics import YOLO

# ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏• YOLOv8
model = YOLO("yolov8n.pt")

st.title("üîç Object Detection ‡∏à‡∏≤‡∏Å URL ‡∏î‡πâ‡∏ß‡∏¢ YOLO (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ OpenCV)")

url = st.text_input("‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á‡∏†‡∏≤‡∏û:")

if url:
    try:
        # ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å URL
        response = requests.get(url)
        image = Image.open(BytesIO(response.content)).convert("RGB")
        st.image(image, caption="‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö", use_column_width=True)

        # ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏
        results = model.predict(image)

        # ‡∏î‡∏∂‡∏á‡∏†‡∏≤‡∏û‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å .plot() ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Image
        result_np = results[0].plot()
        result_img = Image.fromarray(result_np)
        st.image(result_img, caption="‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå Object Detection", use_column_width=True)

        # ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö
        st.subheader("üîé ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ó‡∏µ‡πà‡∏û‡∏ö:")
        labels = results[0].names
        detected = [labels[int(cls)] for cls in results[0].boxes.cls]
        st.write(set(detected))

    except Exception as e:
        st.error(f"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: {e}")
